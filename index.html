<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½èªé‡‘é¡ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã‚²ãƒ¼ãƒ </title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- ã‚·ãƒ³ãƒ—ãƒ«ãªSVGã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ---
        const VolumeIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>
        );

        // --- è¨­å®šå€¤ãªã©ã®å®šç¾© ---
        const REGION_CONFIGS = {
          china: {
            name: 'ä¸­å›½ (å¤§é™¸)', sub: 'æ™®é€šè©± / äººæ°‘å…ƒ', currency: 'CNY', unit: 'å…ƒ',
            denominations: [1, 5, 10, 20, 50, 100],
            voiceLang: 'zh-CN'
          },
          taiwan: {
            name: 'å°æ¹¾ (Taiwan)', sub: 'å°æ¹¾è¯èª / æ–°å°æ¹¾ãƒ‰ãƒ«', currency: 'TWD', unit: 'å…ƒ',
            denominations: [1, 5, 10, 50, 100],
            voiceLang: 'zh-TW'
          }
        };

        const TapiocaDrink = ({ className = "" }) => (
          <div className={`relative w-24 h-32 ${className} flex items-center justify-center`}>
            <div className="absolute top-0 left-[55%] w-2 h-24 bg-red-400 rounded-full -rotate-6 z-0" />
            <div className="absolute top-12 w-20 h-4 bg-white/90 rounded-full z-20 shadow-sm" />
            <div className="absolute bottom-0 w-16 h-24 bg-white/30 backdrop-blur-md border-2 border-white/60 rounded-b-2xl overflow-hidden z-10">
              <div className="absolute bottom-0 w-full h-4/5 bg-amber-200/50" />
              <div className="absolute bottom-2 left-2 w-3 h-3 bg-slate-800 rounded-full" />
              <div className="absolute bottom-3 left-6 w-3 h-3 bg-slate-800 rounded-full" />
              <div className="absolute bottom-1 left-10 w-3 h-3 bg-slate-800 rounded-full" />
            </div>
          </div>
        );

        const DrinkStandBackground = () => (
          <div className="absolute inset-0 z-0 overflow-hidden pointer-events-none">
            <div className="absolute inset-0 bg-sky-50" />
            <div className="absolute top-0 left-0 right-0 h-32 bg-yellow-400 flex shadow-lg">
              {[...Array(8)].map((_, i) => (
                <div key={i} className="flex-1 h-32 border-r border-yellow-500/30 relative">
                  <div className="absolute -bottom-4 left-0 right-0 h-8 bg-yellow-400 rounded-b-full shadow-md" />
                </div>
              ))}
            </div>
            <TapiocaDrink className="absolute top-40 -left-6 opacity-30 -rotate-12 scale-150" />
            <TapiocaDrink className="absolute top-36 -right-4 opacity-20 rotate-12 scale-110" />
          </div>
        );

        const Money = ({ value, region, onClick, size = 'md' }) => {
          const isTaiwan = region === 'taiwan';
          const isCoin = (isTaiwan && value <= 50) || (!isTaiwan && value <= 1);
          const sizeClass = size === 'lg' ? "w-16 h-16 text-xl" : size === 'md' ? "w-12 h-12 text-sm" : "w-10 h-10 text-xs";
          
          return (
            <div 
              onClick={onClick}
              className={`flex items-center justify-center font-bold cursor-pointer transition-transform active:scale-90 shadow-md ${isCoin ? 'rounded-full bg-amber-600 text-white' : 'rounded bg-red-500 text-white w-16 h-8'} ${sizeClass}`}
            >
              {value}
            </div>
          );
        };

        const App = () => {
          const [gameState, setGameState] = useState('title');
          const [region, setRegion] = useState(null);
          const [targetAmount, setTargetAmount] = useState(0);
          const [currentTray, setCurrentTray] = useState([]);

          const startMode = (selectedRegion) => {
            const amount = Math.floor(Math.random() * 900) + 100;
            setTargetAmount(amount);
            setCurrentTray([]);
            setGameState('playing');
            // ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´
            setTimeout(() => speak(amount, selectedRegion), 500);
          };

          const speak = (amount, activeRegion = region) => {
            window.speechSynthesis.cancel();
            const uttr = new SpeechSynthesisUtterance(`ä¸€å…±æ˜¯${amount}å…ƒ`);
            uttr.lang = activeRegion === 'taiwan' ? 'zh-TW' : 'zh-CN';
            uttr.rate = 0.8;
            window.speechSynthesis.speak(uttr);
          };

          if (gameState === 'title') {
            return (
              <div className="flex flex-col items-center justify-center h-screen relative overflow-hidden">
                <DrinkStandBackground />
                <h1 className="text-4xl font-bold z-10 text-sky-900 mb-8">ä¸­å›½èªé‡‘é¡ãƒªã‚¹ãƒ‹ãƒ³ã‚°</h1>
                <button 
                  onClick={() => setGameState('regionSelect')} 
                  className="z-10 bg-sky-600 text-white px-12 py-4 rounded-full font-bold text-xl shadow-lg hover:bg-sky-700 transition-colors"
                >
                  ã‚¹ã‚¿ãƒ¼ãƒˆ
                </button>
              </div>
            );
          }

          if (gameState === 'regionSelect') {
            return (
              <div className="flex flex-col items-center justify-center h-screen p-6 gap-6 bg-sky-50">
                <h2 className="text-2xl font-bold text-sky-900">åœ°åŸŸã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                <button onClick={() => { setRegion('china'); startMode('china'); }} className="w-full max-w-xs p-6 bg-white rounded-2xl shadow-xl border-2 border-transparent hover:border-sky-500 transition-all text-xl font-bold">ğŸ‡¨ğŸ‡³ ä¸­å›½ (å¤§é™¸)</button>
                <button onClick={() => { setRegion('taiwan'); startMode('taiwan'); }} className="w-full max-w-xs p-6 bg-white rounded-2xl shadow-xl border-2 border-transparent hover:border-sky-500 transition-all text-xl font-bold">ğŸ‡¹ğŸ‡¼ å°æ¹¾ (Taiwan)</button>
              </div>
            );
          }

          const currentSum = currentTray.reduce((a, b) => a + b, 0);

          return (
            <div className="flex flex-col h-screen relative overflow-hidden bg-sky-50">
              <div className="p-4 z-10 flex justify-between items-center bg-white/80 backdrop-blur-sm border-b border-sky-100">
                <button onClick={() => setGameState('title')} className="text-sky-600 font-bold">HOME</button>
                <div className="font-bold text-xl text-sky-900">èãå–ã‚Œã‚‹ã‹ãªï¼Ÿ</div>
                <div className="w-12"></div>
              </div>
              
              <div className="flex-grow flex flex-col items-center justify-center z-10 p-4">
                <div 
                  onClick={() => speak(targetAmount)} 
                  className="w-32 h-32 bg-white rounded-full flex items-center justify-center cursor-pointer border-8 border-sky-200 shadow-xl text-sky-500 hover:scale-105 transition-transform active:scale-95"
                >
                  <VolumeIcon />
                </div>
                <p className="mt-6 text-sky-800 font-bold text-lg">åº—å“¡ã•ã‚“ã‚’ã‚¿ãƒƒãƒ—ã—ã¦èãç›´ã™</p>
              </div>

              <div className="bg-white p-6 z-10 rounded-t-[3rem] shadow-[0_-10px_40px_rgba(0,0,0,0.1)]">
                <div className="mb-4 p-4 bg-sky-50 rounded-2xl min-h-[70px] flex flex-wrap gap-2 border-2 border-dashed border-sky-200">
                  {currentTray.map((v, i) => (
                    <Money 
                      key={i} 
                      value={v} 
                      region={region} 
                      size="sm" 
                      onClick={() => setCurrentTray(prev => prev.filter((_, idx) => idx !== i))} 
                    />
                  ))}
                  {currentTray.length === 0 && <span className="text-sky-300 text-sm m-auto font-bold">ã“ã“ã«ãŠé‡‘ã‚’ç½®ã</span>}
                </div>

                <div className="flex justify-between items-center mb-6 px-2">
                  <div className="text-sky-900 font-bold">
                    åˆè¨ˆ: <span className="text-3xl font-black text-sky-600">{currentSum}</span> å…ƒ
                  </div>
                  <button 
                    onClick={() => { 
                      if(currentSum === targetAmount) {
                        alert('æ­£è§£ï¼å¤ªæ£’äº†ï¼'); 
                      } else {
                        alert(`é–“é•ã„ï¼ç­”ãˆã¯ ${targetAmount} å…ƒã§ã—ãŸã€‚`); 
                      }
                      startMode(region); 
                    }} 
                    className="bg-sky-600 text-white px-8 py-3 rounded-full font-bold shadow-lg active:bg-sky-700"
                  >
                    æ”¯æ‰•ã†
                  </button>
                </div>

                <div className="flex flex-wrap gap-3 justify-center mb-4">
                  {REGION_CONFIGS[region].denominations.map(v => (
                    <Money 
                      key={v} 
                      value={v} 
                      region={region} 
                      onClick={() => setCurrentTray([...currentTray, v])} 
                    />
                  ))}
                </div>
                <button 
                   onClick={() => setCurrentTray([])}
                   className="w-full text-slate-400 text-sm font-bold py-2"
                >
                  ã‚„ã‚Šç›´ã—
                </button>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
