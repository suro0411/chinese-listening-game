<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏≠ÂõΩË™û„É™„Çπ„Éã„É≥„Ç∞„Ç≤„Éº„É†„Åä‰ºöË®àÁ∑®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap');
        body { font-family: 'M PLUS Rounded 1c', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Lucide„ÅÆ‰ª£„Çè„Çä„Å´SVG„Ç¢„Ç§„Ç≥„É≥„ÇíÂÆöÁæ© („Ç®„É©„ÉºÂõûÈÅø„ÅÆ„Åü„ÇÅ) ---
        const IconPlay = () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const IconVolume = () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>;
        const IconHome = () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>;
        const IconInfo = () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>;
        const IconTrophy = () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2z"></path></svg>;

        // --- „Ç¢„Çª„ÉÉ„Éà„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---
        const TapiocaDrink = ({ className = "" }) => (
            <div className={`relative w-24 h-32 ${className} flex items-center justify-center`}>
                <div className="absolute top-0 left-[55%] w-2 h-24 bg-red-400 rounded-full -rotate-6 z-0" />
                <div className="absolute top-12 w-20 h-4 bg-white/90 rounded-full z-20 shadow-sm" />
                <div className="absolute bottom-0 w-16 h-24 bg-white/30 backdrop-blur-md border-2 border-white/60 rounded-b-2xl overflow-hidden z-10">
                    <div className="absolute bottom-0 w-full h-4/5 bg-amber-200/50" />
                    {[...Array(6)].map((_, i) => (
                        <div key={i} className="absolute bg-slate-800 rounded-full" style={{
                            width: '10px', height: '10px',
                            bottom: `${Math.random() * 20 + 5}px`,
                            left: `${Math.random() * 40 + 5}px`
                        }} />
                    ))}
                </div>
            </div>
        );

        const Clerk = () => (
            <div className="relative w-48 h-48 flex items-center justify-center group cursor-pointer active:scale-95 transition-transform">
                <div className="absolute inset-0 bg-yellow-300/20 rounded-full animate-pulse scale-110" />
                <div className="relative z-10 w-40 h-40 bg-white rounded-full border-8 border-yellow-400 flex flex-col items-center justify-center overflow-hidden shadow-xl">
                    <div className="absolute top-4 w-28 h-28 bg-orange-100 rounded-full" />
                    <div className="absolute top-4 w-32 h-16 bg-slate-800 rounded-t-full" />
                    <div className="absolute top-16 flex gap-8">
                        <div className="w-3 h-3 bg-slate-800 rounded-full animate-bounce" />
                        <div className="w-3 h-3 bg-slate-800 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }} />
                    </div>
                    <div className="absolute top-22 w-6 h-3 border-b-4 border-rose-400 rounded-full" />
                    <div className="absolute bottom-0 w-full h-12 bg-sky-500 border-t-4 border-white flex justify-center pt-2">
                        <div className="w-16 h-4 bg-white/30 rounded-full" />
                    </div>
                </div>
                <div className="absolute -top-4 -right-4 bg-white p-3 rounded-2xl shadow-lg border-2 border-yellow-400 font-bold text-slate-700 animate-bounce">
                   Âê¨ÔºÅ(ËÅû„ÅÑ„Å¶!)
                </div>
            </div>
        );

        const ShopHeader = () => (
            <div className="absolute top-0 left-0 right-0 h-32 bg-yellow-400 flex shadow-lg z-0">
                {[...Array(8)].map((_, i) => (
                    <div key={i} className="flex-1 h-32 border-r border-yellow-500/30 relative">
                        <div className="absolute -bottom-4 left-0 right-0 h-8 bg-yellow-400 rounded-b-full shadow-md" />
                    </div>
                ))}
            </div>
        );

        // --- „É°„Ç§„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---
        const App = () => {
            const [gameState, setGameState] = useState('title');
            const [region, setRegion] = useState('china');
            const [targetAmount, setTargetAmount] = useState(0);
            const [currentTray, setCurrentTray] = useState([]);

            const denominations = {
                china: [100, 50, 20, 10, 5, 1],
                taiwan: [1000, 500, 100, 50, 10, 5, 1]
            };

            const startGame = (r) => {
                setRegion(r);
                const amount = Math.floor(Math.random() * 999) + 1;
                setTargetAmount(amount);
                setCurrentTray([]);
                setGameState('playing');
                setTimeout(() => speak(amount, r), 500);
            };

            const speak = (amount, r = region) => {
                window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(`‰∏ÄÂÖ±ÊòØ${amount}ÂÖÉ`);
                msg.lang = r === 'china' ? 'zh-CN' : 'zh-TW';
                msg.rate = 0.8;
                window.speechSynthesis.speak(msg);
            };

            const addToTray = (val) => setCurrentTray([...currentTray, val]);
            const removeFromTray = (idx) => setCurrentTray(currentTray.filter((_, i) => i !== idx));
            const currentSum = currentTray.reduce((a, b) => a + b, 0);

            if (gameState === 'title') {
                return (
                    <div className="h-screen w-full max-w-md mx-auto relative bg-sky-50 overflow-hidden flex flex-col items-center justify-center p-6">
                        <ShopHeader />
                        <div className="z-10 text-center">
                            <h1 className="text-4xl font-black text-sky-900 mb-2 drop-shadow-sm">‰∏≠ÂõΩË™ûÈáëÈ°ç</h1>
                            <p className="text-xl font-bold text-sky-600 mb-12">„É™„Çπ„Éã„É≥„Ç∞‰øÆË°å</p>
                            <div className="relative mb-12">
                                <TapiocaDrink className="mx-auto scale-125" />
                                <div className="absolute -bottom-4 -right-4 bg-yellow-400 p-2 rounded-full rotate-12 shadow-lg">
                                    <span className="text-white text-xs font-black">Â•ΩÂñù!</span>
                                </div>
                            </div>
                            <div className="space-y-4 w-64">
                                <button onClick={() => startGame('china')} className="w-full bg-red-500 hover:bg-red-600 text-white font-black py-4 rounded-2xl shadow-xl flex items-center justify-center gap-2 transition-transform active:scale-95">
                                    <IconPlay /> Â§ßÈô∏„É¢„Éº„Éâ (‰∫∫Ê∞ëÂÖÉ)
                                </button>
                                <button onClick={() => startGame('taiwan')} className="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-black py-4 rounded-2xl shadow-xl flex items-center justify-center gap-2 transition-transform active:scale-95">
                                    <IconPlay /> Âè∞Êπæ„É¢„Éº„Éâ (TWD)
                                </button>
                            </div>
                        </div>
                        <div className="absolute bottom-8 text-sky-300 font-bold flex gap-4">
                            <div className="flex items-center gap-1"><IconInfo /> ÈÅä„Å≥Êñπ</div>
                            <div className="flex items-center gap-1"><IconTrophy /> „É©„É≥„Ç≠„É≥„Ç∞</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-screen w-full max-w-md mx-auto relative bg-sky-50 overflow-hidden flex flex-col">
                    <div className="p-4 z-20 flex justify-between items-center">
                        <button onClick={() => setGameState('title')} className="bg-white/80 p-2 rounded-full shadow-sm text-sky-600"><IconHome /></button>
                        <div className="bg-white/80 px-4 py-1 rounded-full shadow-sm font-black text-sky-900">
                            {region === 'china' ? 'üá®üá≥ ‰∫∫Ê∞ëÂÖÉ' : 'üáπüáº Âè∞Êπæ„Éâ„É´'}
                        </div>
                        <div className="w-8"></div>
                    </div>

                    <div className="flex-grow flex flex-col items-center justify-center px-6 relative">
                        <ShopHeader />
                        <div className="mt-12" onClick={() => speak(targetAmount)}>
                            <Clerk />
                        </div>
                        <div className="mt-8 w-full bg-white/60 backdrop-blur-md rounded-3xl p-4 border-4 border-dashed border-sky-200 min-h-[100px] flex flex-wrap gap-2 items-center justify-center shadow-inner">
                            {currentTray.map((v, i) => (
                                <div key={i} onClick={() => removeFromTray(i)} className="bg-orange-400 text-white font-bold px-3 py-1 rounded-lg shadow-sm cursor-pointer hover:bg-red-400">
                                    {v}
                                </div>
                            ))}
                            {currentTray.length === 0 && <p className="text-sky-300 font-bold">„Åì„Åì„Å´ÈáëÈ°ç„Çí‰∏¶„Åπ„Çã</p>}
                        </div>
                    </div>

                    <div className="bg-white rounded-t-[3rem] p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] z-20">
                        <div className="flex justify-between items-center mb-6 px-2">
                            <div className="text-slate-500 font-bold">ÂêàË®à: <span className="text-4xl font-black text-sky-600">{currentSum}</span> ÂÖÉ</div>
                            <button 
                                onClick={() => {
                                    if(currentSum === targetAmount) {
                                        alert("Â§™Ê£í‰∫ÜÔºÅÊ≠£Ëß£„Åß„ÅôÔºÅ");
                                        startGame(region);
                                    } else {
                                        alert(`ÊÆãÂøµÔºÅÊ≠£Ëß£„ÅØ ${targetAmount} ÂÖÉ„Åß„Åó„Åü„ÄÇ`);
                                        startGame(region);
                                    }
                                }}
                                className="bg-sky-600 text-white px-8 py-3 rounded-full font-black text-lg shadow-lg active:scale-95 transition-transform"
                            >
                                ÊîØÊâï„ÅÜ
                            </button>
                        </div>
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            {denominations[region].map(v => (
                                <button key={v} onClick={() => addToTray(v)} className="bg-slate-100 hover:bg-sky-100 py-3 rounded-2xl font-black text-slate-700 shadow-sm border-b-4 border-slate-300 active:border-b-0 active:translate-y-1 transition-all">
                                    {v}
                                </button>
                            ))}
                        </div>
                        <button onClick={() => setCurrentTray([])} className="w-full text-slate-400 font-bold py-2 hover:text-red-400 transition-colors">„ÇØ„É™„Ç¢</button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
